<!-- Tasks For Me Section -->
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h6 class="mb-0">
            <i class="bi bi-person-check me-2"></i>Tasks for Me
            <span x-text="'(' + tasks.length + ')'" class="text-muted ms-1"></span>
        </h6>
    </div>
    <div class="card-body">
        <div x-show="tasks.length === 0" class="text-muted text-center py-3">
            <i class="bi bi-inbox"></i>
            <p class="mb-0 mt-2">No tasks assigned to you</p>
        </div>
        
        <div x-show="tasks.length > 0" class="task-list">
            <template x-for="taskItem in tasks" :key="taskItem.id">
                <div x-data="{
                    get task() { return taskItem; },
                    variant: 'interactive',
                    showProject: true,
                    showAssignee: false,
                    showCreator: true,
                    showActions: true,
                    showFlag: true,
                    alwaysShowMetadata: false,
                    
                    formatDate(dateString) {
                        if (!dateString) return '';
                        const date = new Date(dateString);
                        return date.toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric'
                        });
                    },
                    
                    editTask(task) {
                        const modal = document.getElementById('taskModal');
                        if (modal) {
                            modal.dataset.editTaskId = task.id;
                            modal.dataset.editDescription = task.description;
                            modal.dataset.editProjectId = task.project_id || (task.project_name ? 'lookup' : '');
                            modal.dataset.editProjectName = task.project_name || '';
                            modal.dataset.editUserId = task.assigned_to_id || '';
                            modal.dataset.editUserName = task.assigned_to_name || '';
                            
                            const bootstrapModal = new bootstrap.Modal(modal);
                            bootstrapModal.show();
                        }
                    }
                }">
                    {% include 'partials/task_item.html' %}
                </div>
            </template>
        </div>
        
        <!-- Expandable section for tasks I created -->
        <div x-data="{ 
            expandedTasksICreated: false,
            tasksICreated: [],
            
            async loadTasksICreated() {
                if (this.tasksICreated.length === 0) {
                    try {
                        const response = await fetch('/api/tasks-i-created');
                        const data = await response.json();
                        this.tasksICreated = data.tasks || [];
                    } catch (error) {
                        console.error('Error loading tasks I created:', error);
                    }
                }
            }
        }" class="mt-3 pt-3 border-top">
            <button @click="expandedTasksICreated = !expandedTasksICreated; if (expandedTasksICreated) loadTasksICreated()" 
                    class="btn btn-sm btn-outline-secondary w-100">
                <i class="bi" :class="expandedTasksICreated ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
                <span x-text="expandedTasksICreated ? 'Hide' : 'Show'"></span> Tasks I Created
            </button>
            
            <div x-show="expandedTasksICreated" x-transition class="mt-3">
                <div x-show="tasksICreated.length === 0" class="text-muted text-center py-3">
                    <i class="bi bi-inbox"></i>
                    <p class="mb-0 mt-2">No tasks created by you</p>
                </div>
                
                <div x-show="tasksICreated.length > 0" class="task-list">
                    <template x-for="taskItem in tasksICreated" :key="taskItem.id">
                        <div x-data="{
                            get task() { return taskItem; },
                            variant: 'interactive',
                            showProject: true,
                            showAssignee: true,
                            showCreator: false,
                            showActions: true,
                            showFlag: true,
                            alwaysShowMetadata: false,
                            
                            formatDate(dateString) {
                                if (!dateString) return '';
                                const date = new Date(dateString);
                                return date.toLocaleDateString('en-US', {
                                    year: 'numeric',
                                    month: 'short',
                                    day: 'numeric'
                                });
                            },
                            
                            editTask(task) {
                                const modal = document.getElementById('taskModal');
                                if (modal) {
                                    modal.dataset.editTaskId = task.id;
                                    modal.dataset.editDescription = task.description;
                                    modal.dataset.editProjectId = task.project_id || (task.project_name ? 'lookup' : '');
                                    modal.dataset.editProjectName = task.project_name || '';
                                    modal.dataset.editUserId = task.assigned_to_id || '';
                                    modal.dataset.editUserName = task.assigned_to_name || '';
                                    
                                    const bootstrapModal = new bootstrap.Modal(modal);
                                    bootstrapModal.show();
                                }
                            }
                        }">
                            {% include 'partials/task_item.html' %}
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>
</div> 